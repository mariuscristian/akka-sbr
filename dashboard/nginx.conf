events {}

http {
    include       mime.types;
    default_type  application/octet-stream;

    resolver 127.0.0.11 valid=5s;

    server {
        listen 80;

        root /usr/share/nginx/html;
        index index.html;

        # Proxy to Node 1
        location /api/node1/ {
            set $upstream_node1 node-1;
            rewrite ^/api/node1/(.*) /$1 break;
            proxy_pass http://$upstream_node1:8558;
        }

        # Proxy to Node 2
        location /api/node2/ {
            set $upstream_node2 node-2;
            rewrite ^/api/node2/(.*) /$1 break;
            proxy_pass http://$upstream_node2:8558;
        }

        # Proxy to Node 3
        location /api/node3/ {
            set $upstream_node3 node-3;
            rewrite ^/api/node3/(.*) /$1 break;
            proxy_pass http://$upstream_node3:8558;
        }

        # Proxy to Node 4
        location /api/node4/ {
            set $upstream_node4 node-4;
            rewrite ^/api/node4/(.*) /$1 break;
            proxy_pass http://$upstream_node4:8558;
        }
    }
}
